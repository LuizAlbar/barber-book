generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id          String       @id @default(uuid())
  name        String
  email       String       @unique
  password    String
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  phone       String?
  barbershops Barbershop[]
  employees   Employee[]

  @@map("users")
}

model Barbershop {
  id              String           @id @default(uuid())
  name            String
  fullAddress     String           @map("full_address")
  neighborhood    String
  referencePoint  String?          @map("reference_point")
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  ownerId         String           @map("owner_id")
  barberSchedules BarberSchedule[]
  owner           User             @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  capital         Capital[]
  employees       Employee[]
  services        Service[]

  @@map("barbershops")
}

model Employee {
  id           String        @id @default(uuid())
  phoneNumber  String        @map("phone_number")
  role         EmployeeRole
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  userId       String        @map("user_id")
  barbershopId String        @map("barbershop_id")
  appointments Appointment[]
  barbershop   Barbershop    @relation(fields: [barbershopId], references: [id], onDelete: Cascade)
  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("employees")
}

model Service {
  id           String        @id @default(uuid())
  name         String
  price        Float
  timeTaken    Int           @map("time_taken")
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  barbershopId String        @map("barbershop_id")
  appointments Appointment[]
  barbershop   Barbershop    @relation(fields: [barbershopId], references: [id], onDelete: Cascade)

  @@map("services")
}

model Appointment {
  id            String            @id @default(uuid())
  clientName    String            @map("client_name")
  clientContact String            @map("client_contact")
  datetime      DateTime
  status        AppointmentStatus @default("PENDING")
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt
  employeeId    String            @map("employee_id")
  serviceId     String            @map("service_id")
  capitalId     String?           @unique @map("capital_id")
  capital       Capital?          @relation(fields: [capitalId], references: [id])
  service       Service           @relation(fields: [serviceId], references: [id], onDelete: Cascade)
  employee      Employee          @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@map("appointments")
}

model Capital {
  id           String       @id @default(uuid())
  value        Float
  type         CapitalType
  datetime     DateTime     @default(now())
  description  String?
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  barbershopId String       @map("barbershop_id")
  appointment  Appointment?
  barbershop   Barbershop   @relation(fields: [barbershopId], references: [id], onDelete: Cascade)

  @@map("capital")
}

model BarberSchedule {
  id            String         @id @default(uuid())
  daysOfWeek    String         @map("days_of_week")
  openTime      Int            @map("open_time")
  closeTime     Int            @map("close_time")
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  barbershopId  String         @map("barbershop_id")
  barbershop    Barbershop     @relation(fields: [barbershopId], references: [id], onDelete: Cascade)
  breakingTimes BreakingTime[]

  @@map("barber_schedules")
}

model BreakingTime {
  id           String         @id @default(uuid())
  startingTime Int            @map("starting_time")
  endingTime   Int            @map("ending_time")
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  scheduleId   String         @map("schedule_id")
  schedule     BarberSchedule @relation(fields: [scheduleId], references: [id], onDelete: Cascade)

  @@map("breaking_times")
}

enum EmployeeRole {
  BARBEIRO
  ATENDENTE
}

enum AppointmentStatus {
  PENDING
  COMPLETED
  CANCELLED
}

enum CapitalType {
  PROFIT
  COST
}
